<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Login Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="min-h-screen flex flex-col items-center justify-center text-center p-4">

        <h1 class="text-3xl font-bold mb-4">Firebase Authentication Test</h1>
        <p class="mb-8 text-gray-600">This page tests the core Google Sign-In functionality.</p>

        <!-- Logged Out State -->
        <div id="logged-out-view">
            <button id="login-button" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-blue-700 transition-colors">
                Login with Google
            </button>
        </div>

        <!-- Logged In State -->
        <div id="logged-in-view" class="hidden bg-white p-8 rounded-lg shadow-xl">
            <h2 class="text-2xl font-bold text-green-600 mb-4">Login Successful!</h2>
            <div id="user-info" class="mb-6 text-left">
                <p><strong>Name:</strong> <span id="user-name"></span></p>
                <p><strong>Email:</strong> <span id="user-email"></span></p>
                <p><strong>UID:</strong> <span id="user-uid" class="text-xs text-gray-500"></span></p>
            </div>
            <a href="focus.html" id="focus-button" class="inline-block bg-gray-800 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-gray-900 transition-colors mr-4">
                Go to Focus Page
            </a>
            <button id="logout-button" class="bg-red-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-red-700 transition-colors">
                Logout
            </button>
        </div>

    </div>

    <!-- Firebase Script -->
    <script type="module">
        // 1. Import Firebase Services
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-auth.js";

        // 2. Your Firebase Configuration (Using your provided keys)
        const firebaseConfig = {
            apiKey: "AIzaSyAupZMTnCqwyz7WEGcA8pJS1r0nnYA6bMk",
            authDomain: "checkmeout-b57f2.firebaseapp.com",
            projectId: "checkmeout-b57f2",
            storageBucket: "checkmeout-b57f2.appspot.com",
            messagingSenderId: "199208936999",
            appId: "1:199208936999:web:56db3d05695e158d0bd002",
            measurementId: "G-S6T4G00G7F"
        };

        // 3. Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // 4. Get references to the HTML elements
        const loggedInView = document.getElementById('logged-in-view');
        const loggedOutView = document.getElementById('logged-out-view');
        const loginButton = document.getElementById('login-button');
        const logoutButton = document.getElementById('logout-button');
        const userInfo = document.getElementById('user-info');
        const userNameEl = document.getElementById('user-name');
        const userEmailEl = document.getElementById('user-email');
        const userUidEl = document.getElementById('user-uid');

        // 5. Add click listeners
        loginButton.addEventListener('click', () => {
            signInWithPopup(auth, provider)
                .then((result) => {
                    console.log("Sign-in successful:", result.user);
                })
                .catch((error) => {
                    console.error("Authentication Error:", error);
                    alert(`Login Failed! Error: ${error.message}. Check the console for more details.`);
                });
        });

        logoutButton.addEventListener('click', () => {
            signOut(auth);
        });

        // 6. Listen for authentication state changes (the core logic)
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in
                console.log("onAuthStateChanged: User is logged in.", user);
                
                // Show the logged-in view and hide the logged-out view
                loggedInView.classList.remove('hidden');
                loggedOutView.classList.add('hidden');

                // Display user's information
                userNameEl.textContent = user.displayName;
                userEmailEl.textContent = user.email;
                userUidEl.textContent = user.uid;

            } else {
                // User is signed out
                console.log("onAuthStateChanged: User is logged out.");

                // Show the logged-out view and hide the logged-in view
                loggedOutView.classList.remove('hidden');
                loggedInView.classList.add('hidden');
            }
        });

    </script>
</body>
</html>
